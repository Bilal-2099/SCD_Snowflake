# AWS EC2 Docker & NiFi Setup with Port Forwarding

This guide explains how to create an **AWS EC2 instance**, configure **security groups**, install **Docker & Docker Compose**, deploy services (NiFi, Jupyter, etc.), and prepare test data.

---

## 1. EC2 Instance & Security Group Configuration

### EC2 Instance

* Instance type: **t2.xlarge**
* Storage: **32 GB (recommended)**
* OS: Amazon Linux

### Security Group Rules

* Allow inbound TCP ports: **4000 – 38888**
* Allow SSH (port **22**) from your IP

---

## 2. Connect to EC2 via SSH

### Basic SSH Connection

```bash
ssh -i "ec2-sk.pem" ec2-user@ec2-98-84-126-230.compute-1.amazonaws.com
```

### SSH with Port Forwarding

```bash
ssh -i "ec2-sk.pem" ec2-user@ec2-98-84-126-230.compute-1.amazonaws.com \
-L 2081:localhost:2041 \
-L 4888:localhost:4888 \
-L 2080:localhost:2080 \
-L 8050:localhost:8050 \
-L 4141:localhost:4141
```

This allows access to EC2 services from your **local machine browser**.

---

## 3. Copy Project Files to EC2

```bash
scp -r -i "ec2-sk.pem" docker_exp \
ec2-user@ec2-98-84-126-230.compute-1.amazonaws.com:/home/ec2-user/docker_exp
```

Verify files on EC2:

```bash
ls
cd docker_exp
ls
```

---

## 4. Install Docker & Docker Compose

Update system:

```bash
sudo yum update -y
```

Install Docker:

```bash
sudo yum install docker -y
```

Install Docker Compose:

```bash
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname -s)-$(uname -m)" \
-o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

Add user to Docker group:

```bash
sudo gpasswd -a $USER docker
newgrp docker
```

Install Python Pip & Docker Compose (Python):

```bash
sudo yum install python-pip -y
sudo pip install docker-compose
```

---

## 5. Start Docker Services

Start Docker daemon:

```bash
sudo systemctl start docker
```

Verify Docker:

```bash
docker ps
```

Start containers:

```bash
docker-compose up
```

---

## 6. Access Docker Containers

### List running containers

```bash
docker ps
```

### Access NiFi container CLI

```bash
docker exec -i -t nifi bash
```

Example dataset location:

```bash
/opt/workspace/nifi/FakeDataset/customer_20241020045103.csv
```

Stop containers:

```bash
docker-compose down
```

---

## 7. Stop Docker Service

```bash
sudo systemctl stop docker
```

---

## 8. Access Tools from Local Machine

Use your **EC2 Public IP** in the browser:

* **Jupyter Lab**:
  `http://<EC2_PUBLIC_IP>:4888/lab`

* **Apache NiFi**:
  `http://<EC2_PUBLIC_IP>:2080/nifi/`

---

## 9. Test Data Preparation

Access NiFi container:

```bash
docker exec -i -t nifi bash
```

Copy test data:

```bash
cp /opt/workspace/nifi/FakeDataset/customer_20241020045103.csv scd/
```

Target directory:

```bash
/opt/nifi/nifi-current/scd
```

---

## Notes

* Replace `<EC2_PUBLIC_IP>` with your actual EC2 public IP
* Ensure required ports are open in the Security Group
* Docker must be running before using NiFi or Jupyter

---

✅ EC2 Docker & NiFi setup completed successfully
